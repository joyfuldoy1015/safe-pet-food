-- ============================================
-- Community Q&A Test Data
-- ============================================
-- Purpose: Insert sample questions and answers
-- ============================================

-- ============================================
-- STEP 1: Ensure test user and profile exist
-- ============================================

-- Get current user ID (use your actual logged-in user ID)
-- Replace this with your actual user ID from: SELECT id FROM auth.users LIMIT 1;
DO $$
DECLARE
  test_user_id UUID := '97562a83-669d-4298-9d8e-e866cba61d6f';
BEGIN
  -- Ensure profile exists
  INSERT INTO profiles (id, nickname, avatar_url)
  VALUES (test_user_id, '조아폼토이', NULL)
  ON CONFLICT (id) DO NOTHING;
END $$;

-- ============================================
-- STEP 2: Insert test questions
-- ============================================

INSERT INTO community_questions (id, title, content, author_id, category, status, votes, views)
VALUES 
  (
    'c1111111-1111-1111-1111-111111111111',
    '강아지가 사료를 잘 안 먹어요. 어떻게 해야 할까요?',
    '3살 골든리트리버인데 최근에 사료를 잘 안 먹습니다. 건강에는 문제가 없어 보이는데 식욕이 떨어진 것 같아요.

평소에는 잘 먹던 아이인데 2주 전부터 갑자기 사료를 남기기 시작했어요. 간식은 잘 먹는데 사료만 안 먹어서 걱정입니다.

혹시 비슷한 경험 있으신 분들 조언 부탁드려요. 병원에 가봐야 할까요?',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '🍖 사료 & 영양',
    'answered',
    15,
    234
  ),
  (
    'c2222222-2222-2222-2222-222222222222',
    '고양이 모래 추천 부탁드립니다',
    '털 빠짐이 심한 장모종 고양이를 키우고 있는데, 모래가 털에 잘 붙지 않는 제품이 있을까요?

현재는 일반 벤토나이트 모래를 사용하고 있는데, 털에 많이 붙어서 청소가 힘들어요. 클레이 모래나 다른 종류의 모래를 추천해주시면 감사하겠습니다!',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '💬 자유토론',
    'open',
    8,
    156
  ),
  (
    'c3333333-3333-3333-3333-333333333333',
    '강아지 영양제 급여 시기가 궁금해요',
    '6개월 된 강아지인데 언제부터 영양제를 급여하는 게 좋을까요? 필수 영양제가 있다면 추천해주세요.

현재는 사료만 먹이고 있는데, 주변에서 영양제를 먹여야 한다는 말을 들어서 궁금합니다. 어떤 영양제가 필요한지, 언제부터 시작하는 게 좋은지 알려주세요!',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '❤️ 건강',
    'answered',
    22,
    312
  ),
  (
    'c4444444-4444-4444-4444-444444444444',
    '강아지 산책 시 다른 강아지와 싸워요',
    '1살 된 믹스견을 키우고 있는데, 산책할 때 다른 강아지를 만나면 짖거나 공격적인 행동을 보여요.

사회화가 부족한 것 같은데, 어떻게 훈련해야 할까요? 전문 훈련사에게 맡겨야 할까요?',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '🎓 훈련 & 행동',
    'open',
    12,
    189
  ),
  (
    'c5555555-5555-5555-5555-555555555555',
    '고양이 화장실 훈련 방법',
    '새로 입양한 3개월 고양이인데, 화장실을 제대로 사용하지 못해요.

모래는 어디에 두는 게 좋고, 어떻게 훈련해야 할까요?',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '🎓 훈련 & 행동',
    'answered',
    18,
    267
  ),
  (
    'c6666666-6666-6666-6666-666666666666',
    '강아지 사료 브랜드 추천해주세요',
    '골든리트리버 2살을 키우고 있는데, 어떤 사료 브랜드가 좋을까요?

알레르기가 있어서 곡물 없는 사료를 찾고 있어요. 가격대는 중간 정도면 좋겠습니다.',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '🍖 사료 & 영양',
    'answered',
    25,
    445
  )
ON CONFLICT (id) DO NOTHING;

-- ============================================
-- STEP 3: Insert test answers
-- ============================================

INSERT INTO community_answers (id, question_id, author_id, content, is_accepted, votes)
VALUES 
  -- Question 1 answers
  (
    'a1111111-1111-1111-1111-111111111111',
    'c1111111-1111-1111-1111-111111111111',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '제 강아지도 비슷한 경험이 있었어요. 사료를 바꿔보니 잘 먹더라구요. 혹시 같은 사료를 오래 먹였다면 맛에 질렸을 수도 있어요.',
    TRUE,
    8
  ),
  (
    'a1111112-1111-1111-1111-111111111112',
    'c1111111-1111-1111-1111-111111111111',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '간식을 줄이고 사료만 주면 결국 먹게 됩니다. 배고프면 먹어요!',
    FALSE,
    3
  ),
  (
    'a1111113-1111-1111-1111-111111111113',
    'c1111111-1111-1111-1111-111111111111',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '병원에 가서 검진 받아보시는 게 좋을 것 같아요. 치아나 소화기 문제일 수도 있습니다.',
    FALSE,
    5
  ),
  
  -- Question 2 answers
  (
    'a2222221-2222-2222-2222-222222222221',
    'c2222222-2222-2222-2222-222222222222',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '두부 모래 추천드려요! 털에 안 붙고 먼지도 적어요.',
    FALSE,
    4
  ),
  (
    'a2222222-2222-2222-2222-222222222222',
    'c2222222-2222-2222-2222-222222222222',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '펠렛 형태 모래를 써보세요. 털에 잘 안 붙어요.',
    FALSE,
    2
  ),

  -- Question 3 answers (5 answers)
  (
    'a3333331-3333-3333-3333-333333333331',
    'c3333333-3333-3333-3333-333333333333',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '6개월이면 아직 영양제 필요 없어요. 좋은 사료만 먹이면 충분합니다.',
    TRUE,
    10
  ),
  (
    'a3333332-3333-3333-3333-333333333332',
    'c3333333-3333-3333-3333-333333333333',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '관절 영양제는 1살 이후부터 추천드려요.',
    FALSE,
    6
  ),
  (
    'a3333333-3333-3333-3333-333333333333',
    'c3333333-3333-3333-3333-333333333333',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '수의사와 상담 후 결정하는 게 가장 좋아요!',
    FALSE,
    3
  ),
  (
    'a3333334-3333-3333-3333-333333333334',
    'c3333333-3333-3333-3333-333333333333',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '오메가3 영양제는 피부와 털에 좋아요.',
    FALSE,
    4
  ),
  (
    'a3333335-3333-3333-3333-333333333335',
    'c3333333-3333-3333-3333-333333333333',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '프로바이오틱스 추천합니다. 소화에 도움이 됩니다.',
    FALSE,
    5
  ),

  -- Question 4 answers (4 answers)
  (
    'a4444441-4444-4444-4444-444444444441',
    'c4444444-4444-4444-4444-444444444444',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '전문 훈련사에게 상담 받아보세요. 사회화 훈련이 필요합니다.',
    FALSE,
    5
  ),
  (
    'a4444442-4444-4444-4444-444444444442',
    'c4444444-4444-4444-4444-444444444444',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '리드줄을 짧게 잡고 천천히 다가가는 연습을 해보세요.',
    FALSE,
    3
  ),
  (
    'a4444443-4444-4444-4444-444444444443',
    'c4444444-4444-4444-4444-444444444444',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '간식으로 긍정적 경험을 만들어주는 게 중요해요.',
    FALSE,
    4
  ),
  (
    'a4444444-4444-4444-4444-444444444444',
    'c4444444-4444-4444-4444-444444444444',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '사회화 수업을 등록해보시는 건 어떨까요?',
    FALSE,
    2
  ),

  -- Question 5 answers (6 answers)
  (
    'a5555551-5555-5555-5555-555555555551',
    'c5555555-5555-5555-5555-555555555555',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '화장실은 조용하고 접근하기 쉬운 곳에 두세요.',
    TRUE,
    7
  ),
  (
    'a5555552-5555-5555-5555-555555555552',
    'c5555555-5555-5555-5555-555555555555',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '고양이를 화장실로 자주 데려가서 익숙하게 해주세요.',
    FALSE,
    4
  ),
  (
    'a5555553-5555-5555-5555-555555555553',
    'c5555555-5555-5555-5555-555555555555',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '밥 먹고 나서나 잠에서 깨면 바로 화장실로 데려가세요.',
    FALSE,
    6
  ),
  (
    'a5555554-5555-5555-5555-555555555554',
    'c5555555-5555-5555-5555-555555555555',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '실수해도 절대 혼내지 마세요. 긍정적 강화만 하세요.',
    FALSE,
    5
  ),
  (
    'a5555555-5555-5555-5555-555555555555',
    'c5555555-5555-5555-5555-555555555555',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '모래 개수를 늘려보세요. 고양이 수 + 1개가 이상적입니다.',
    FALSE,
    3
  ),
  (
    'a5555556-5555-5555-5555-555555555556',
    'c5555555-5555-5555-5555-555555555555',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '페로몬 스프레이를 사용하면 스트레스 감소에 도움이 됩니다.',
    FALSE,
    2
  ),

  -- Question 6 answers (8 answers)
  (
    'a6666661-6666-6666-6666-666666666661',
    'c6666666-6666-6666-6666-666666666666',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '오리젠 그레인프리 추천해요! 품질 좋고 알레르기에도 좋습니다.',
    TRUE,
    12
  ),
  (
    'a6666662-6666-6666-6666-666666666662',
    'c6666666-6666-6666-6666-666666666666',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '아카나도 좋아요. 곡물 없고 단백질 함량 높습니다.',
    FALSE,
    8
  ),
  (
    'a6666663-6666-6666-6666-666666666663',
    'c6666666-6666-6666-6666-666666666666',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '나우프레시 추천합니다. 가격도 적당하고 품질도 좋아요.',
    FALSE,
    6
  ),
  (
    'a6666664-6666-6666-6666-666666666664',
    'c6666666-6666-6666-6666-666666666666',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '로얄캐닌 저알러지 라인도 고려해보세요.',
    FALSE,
    4
  ),
  (
    'a6666665-6666-6666-6666-666666666665',
    'c6666666-6666-6666-6666-666666666666',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '힐스 사이언스 다이어트 센서티브 스토맥도 좋습니다.',
    FALSE,
    5
  ),
  (
    'a6666666-6666-6666-6666-666666666666',
    'c6666666-6666-6666-6666-666666666666',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    'ANF 홀리스틱 시그니처 추천해요. 가성비 좋아요.',
    FALSE,
    3
  ),
  (
    'a6666667-6666-6666-6666-666666666667',
    'c6666666-6666-6666-6666-666666666666',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '네츄럴코어도 국내 브랜드로 괜찮습니다.',
    FALSE,
    2
  ),
  (
    'a6666668-6666-6666-6666-666666666668',
    'c6666666-6666-6666-6666-666666666666',
    '97562a83-669d-4298-9d8e-e866cba61d6f',
    '수의사와 상담 후 결정하시는 게 가장 확실합니다!',
    FALSE,
    7
  )
ON CONFLICT (id) DO NOTHING;

-- ============================================
-- STEP 4: Verification
-- ============================================

SELECT '=== Questions Count ===' as step;
SELECT 
  category,
  COUNT(*) as count,
  SUM(votes) as total_votes,
  SUM(views) as total_views
FROM community_questions
GROUP BY category
ORDER BY COUNT(*) DESC;

SELECT '=== Answers Count ===' as step;
SELECT 
  q.title,
  COUNT(a.id) as answer_count,
  SUM(a.votes) as total_votes
FROM community_questions q
LEFT JOIN community_answers a ON a.question_id = q.id
GROUP BY q.id, q.title
ORDER BY answer_count DESC;

SELECT '=== Questions with Author ===' as step;
SELECT 
  q.id,
  q.title,
  q.category,
  q.votes,
  q.views,
  p.nickname as author
FROM community_questions q
LEFT JOIN profiles p ON p.id = q.author_id
ORDER BY q.votes DESC
LIMIT 10;

SELECT '✅ Test data inserted successfully!' as status;
