# 테스트 가이드

> Safe Pet Food 프로젝트 - Phase 1 & 2 완료 후 테스트

**작성일**: 2024-12-26  
**버전**: 1.0

---

## 🚀 **1. 개발 서버 시작**

### **Step 1-1: 기존 프로세스 정리**
```bash
# 기존 Next.js 프로세스 종료
pkill -f "next dev"

# 포트 확인 및 해제
lsof -ti:3000,3001,3002,3003,3004 | xargs kill -9 2>/dev/null || true

# 3초 대기
sleep 3
```

### **Step 1-2: 캐시 정리 (선택사항)**
```bash
# .next 빌드 캐시 삭제
rm -rf .next

# node_modules 재설치 (문제 발생 시)
rm -rf node_modules && npm install
```

### **Step 1-3: 개발 서버 시작**
```bash
# 프로젝트 디렉토리로 이동
cd /Users/doheekong/Downloads/spf_cursor_test

# 개발 서버 실행
npm run dev
```

✅ **확인 포인트**:
- 포트 3000에서 실행되는지 확인
- `ready - started server on 0.0.0.0:3000` 메시지 확인
- 에러 없이 컴파일 완료되는지 확인

---

## 🔍 **2. Multiple GoTrueClient 해결 확인**

### **Step 2-1: 브라우저 콘솔 확인**
```
1. Chrome/Safari 열기
2. http://localhost:3000 접속
3. F12 (또는 Cmd+Option+I) → Console 탭
4. 페이지 새로고침 (Cmd+R)
```

✅ **예상 결과**:
```
[Supabase] Browser client initialized  ← 1번만 표시되어야 함
```

❌ **이전 문제** (해결됨):
```
Multiple GoTrueClient instances detected...  ← 더 이상 표시되지 않음
```

### **Step 2-2: 로그인 테스트**
```
1. 로그아웃 상태로 시작
2. /login 페이지 접속
3. 로그인 진행
4. 콘솔에서 에러 확인
```

✅ **성공 기준**: 로그인 정상 작동, 경고 메시지 없음

---

## 🐾 **3. Pets 데이터 확인**

### **Step 3-1: 마이페이지 확인**
```
1. 로그인
2. /profile 페이지 접속
3. "내 반려동물" 섹션 확인
```

✅ **예상 결과**:
```
┌─────────────────────────────────────────┐
│  🐶 뽀미     3세    28kg                 │
│  골든 리트리버                           │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│  🐶 코코     4세    32kg                 │
│  대형견                                  │
└─────────────────────────────────────────┘
```

❌ **문제 발생 시**:
- "등록된 반려동물이 없습니다" 표시
- → `scripts/insert-sample-pets.sql` 다시 실행

---

## ✏️ **4. 급여 후기 수정/삭제 테스트**

### **Step 4-1: 기존 후기 확인**
```
1. /pet-log 페이지 접속
2. "내 경험 공유하기" 버튼 클릭
3. 샘플 후기 작성 및 게시
```

### **Step 4-2: 수정 기능 테스트**
```
1. 작성한 후기 클릭 (상세 페이지)
2. 상단에 "수정" 버튼 확인 ← ⚠️ 작성자만 보임
3. "수정" 버튼 클릭
4. 내용 수정 후 저장
5. 상세 페이지로 돌아가는지 확인
```

✅ **성공 기준**:
- [x] 수정 페이지에서 기존 내용이 pre-fill 됨
- [x] 수정 후 저장 시 변경사항 반영
- [x] "수정되었습니다!" 알림 표시
- [x] 상세 페이지로 리다이렉트

### **Step 4-3: 삭제 기능 테스트**
```
1. 작성한 후기 상세 페이지
2. "삭제" 버튼 클릭 ← ⚠️ 작성자만 보임
3. 확인 모달 표시 확인
4. "확인" 클릭
5. /pet-log 페이지로 돌아가는지 확인
```

✅ **성공 기준**:
- [x] 확인 모달 표시됨
- [x] 삭제 후 "게시글이 삭제되었습니다" 알림
- [x] /pet-log로 리다이렉트
- [x] 해당 후기가 목록에서 사라짐

### **Step 4-4: 권한 확인 (중요!)**
```
1. 다른 계정으로 로그인 (또는 시크릿 모드)
2. 남의 후기 상세 페이지 접속
3. 수정/삭제 버튼이 보이지 않는지 확인 ← ⚠️ 중요!
```

✅ **성공 기준**: 작성자가 아니면 수정/삭제 버튼이 보이지 않음

---

## 🏠 **5. 마이페이지 통합 대시보드 테스트**

### **Step 5-1: 프로필 정보**
```
1. /profile 페이지 접속
2. 닉네임, 이메일, 가입일 표시 확인
3. "프로필 수정" 버튼 클릭
4. 닉네임 변경 후 저장
```

✅ **성공 기준**: 변경사항 즉시 반영

### **Step 5-2: 내 반려동물 섹션**
```
1. "내 반려동물" 섹션 확인
2. 등록된 반려동물 카드 표시 확인
3. 반려동물 카드 클릭 → 상세 페이지 이동
4. "+ 추가" 버튼 클릭 → 등록 페이지 이동
```

✅ **성공 기준**: 
- 반려동물 이름, 나이, 종류 표시
- 카드 클릭 시 페이지 이동
- 빈 상태 시 등록 유도 표시

### **Step 5-3: 내 급여 후기 섹션**
```
1. "내 급여 후기" 섹션 확인
2. 작성한 후기 목록 표시 확인
3. 조회수, 좋아요, 댓글 수 표시 확인
4. 후기 카드 클릭 → 상세 페이지 이동
5. "+ 작성" 버튼 클릭 → 작성 페이지 이동
```

✅ **성공 기준**:
- 최근 5개 후기 표시
- 통계 정보 정상 표시
- 빈 상태 시 작성 유도 표시

---

## 📊 **6. FeedingLeaderboard 테스트**

### **Step 6-1: 홈 페이지 확인**
```
1. / (홈) 페이지 접속
2. "급여 랭킹" 섹션 확인
3. 로딩 상태 → 5초 이내 데이터 표시 확인
```

✅ **예상 결과** (개발 환경):
```
급여 랭킹
┌──────────────────────────────────────┐
│ 1  로얄캐닌 · 골든 리트리버 어덜트    │
│    최장 365일 · 언급 12건              │
├──────────────────────────────────────┤
│ 2  힐스 · 어덜트 라지 브리드          │
│    최장 180일 · 언급 8건               │
├──────────────────────────────────────┤
│ 3  오리젠 · 오리지널                  │
│    최장 120일 · 언급 5건               │
└──────────────────────────────────────┘
```

### **Step 6-2: 탭 전환 테스트**
```
1. "신뢰(장기간)" 탭 클릭
2. "인기(언급)" 탭 클릭
3. "추천(혼합)" 탭 클릭
4. 각 탭마다 다른 데이터 표시 확인
```

### **Step 6-3: 필터 테스트**
```
1. 반려동물 필터: 전체 / 강아지 / 고양이
2. 제품군 필터: 전체 / 사료 / 간식 / 영양제 / 화장실
3. 필터 변경 시 데이터 변경 확인
```

✅ **성공 기준**:
- 5초 이내 데이터 표시 (mock 또는 실제)
- 탭/필터 전환 정상 작동
- 에러 화면 표시되지 않음

---

## 🔄 **7. 로그인 타임아웃 수정 확인**

### **Step 7-1: 로그 작성 모달 테스트**
```
1. 로그인 상태에서 /owners/owner-1/pets/pet-1 접속
2. "새 로그 작성" 버튼 클릭
3. 모달이 즉시 열리는지 확인 (로딩 시간 < 6초)
```

✅ **성공 기준**:
- 로그인 모달 오류 표시되지 않음
- 로그 작성 폼 즉시 표시
- 콘솔에 타임아웃 경고 없음

❌ **이전 문제** (해결됨):
```
[LogFormDialog] Auth loading timeout after 3 seconds
"로그인이 필요합니다" 모달 표시 (로그인 상태인데도!)
```

---

## 🎨 **8. 반응형 테스트**

### **Step 8-1: 모바일 뷰**
```
1. Chrome DevTools 열기 (F12)
2. Toggle device toolbar (Cmd+Shift+M)
3. 390px 너비로 설정
4. 모든 페이지 확인:
   - 홈 (/): 히어로, 피처, 리더보드
   - 마이페이지 (/profile)
   - 급여 후기 상세 (/pet-log/posts/[postId])
```

✅ **성공 기준**:
- [x] 텍스트 줄바꿈 정상
- [x] 버튼 배치 적절
- [x] 스크롤 가능
- [x] 터치 영역 충분

### **Step 8-2: 태블릿 뷰**
```
1. 768px 너비로 설정
2. 레이아웃 변화 확인
```

### **Step 8-3: 데스크톱 뷰**
```
1. 1920px 너비로 설정
2. 모든 요소 정상 표시 확인
```

---

## 🐛 **9. 에러 시나리오 테스트**

### **Step 9-1: 권한 없는 수정 시도**
```
1. 브라우저 DevTools → Console
2. 다음 코드 실행:
   fetch('/api/pet-log/posts/SOME_POST_ID', { 
     method: 'PATCH', 
     body: JSON.stringify({ post: {}, feedingRecords: [] }) 
   })
3. 403 Forbidden 응답 확인
```

### **Step 9-2: 로그아웃 상태에서 접근**
```
1. 로그아웃
2. /pet-log/posts/write 접근
3. 로그인 페이지로 리다이렉트 확인
```

### **Step 9-3: 존재하지 않는 포스트**
```
1. /pet-log/posts/invalid-id 접근
2. 404 페이지 또는 "게시글을 찾을 수 없습니다" 메시지 확인
```

---

## ✅ **10. 최종 체크리스트**

### **기능 테스트**
- [ ] Multiple GoTrueClient 경고 없음
- [ ] Pets 데이터 정상 표시
- [ ] 급여 후기 수정 기능 작동
- [ ] 급여 후기 삭제 기능 작동
- [ ] 마이페이지 대시보드 정상 표시
- [ ] FeedingLeaderboard 5초 이내 표시
- [ ] 로그인 타임아웃 문제 없음

### **권한 테스트**
- [ ] 작성자만 수정/삭제 버튼 보임
- [ ] 비작성자는 수정/삭제 불가
- [ ] 로그아웃 시 적절히 리다이렉트

### **UI/UX 테스트**
- [ ] 모바일 반응형 정상
- [ ] 로딩 상태 표시
- [ ] 에러 처리 적절
- [ ] 알림 메시지 표시

### **성능 테스트**
- [ ] 페이지 로딩 < 3초
- [ ] 리더보드 로딩 < 5초
- [ ] 로그인 모달 < 6초
- [ ] 포트 3000에서만 실행

---

## 🔧 **문제 해결**

### **"등록된 반려동물이 없습니다" 표시될 때**
```bash
# Supabase SQL Editor에서 실행
# 1. User ID 확인
SELECT id, email FROM auth.users WHERE email = 'your-email@example.com';

# 2. scripts/insert-sample-pets.sql 실행 (USER_ID 교체)
```

### **"Multiple GoTrueClient" 경고 표시될 때**
```bash
# 캐시 정리 및 재시작
rm -rf .next
pkill -f "next dev"
npm run dev
```

### **포트 충돌 발생 시**
```bash
# 모든 프로세스 종료 및 포트 해제
pkill -f "next dev"
lsof -ti:3000,3001,3002,3003,3004 | xargs kill -9
sleep 3
npm run dev
```

### **리더보드가 표시되지 않을 때**
```
✅ 정상: 개발 환경에서는 mock data 표시됨
✅ 5초 후 데이터 표시되면 정상
❌ 빈 화면이면 콘솔 에러 확인
```

---

## 📊 **예상 결과 요약**

| 테스트 항목 | 예상 시간 | 성공 기준 |
|-----------|----------|----------|
| 서버 시작 | 1분 | 포트 3000, 에러 없음 |
| GoTrueClient | 즉시 | 경고 1번만 또는 없음 |
| Pets 표시 | 즉시 | 카드 정상 표시 |
| 후기 수정 | 1-2초 | 저장 및 리다이렉트 |
| 후기 삭제 | 1초 | 삭제 및 리다이렉트 |
| 마이페이지 | 1-2초 | 모든 섹션 표시 |
| 리더보드 | 5초 이내 | Mock 또는 실제 데이터 |
| 로그인 모달 | 6초 이내 | 폼 즉시 표시 |

---

## 🎉 **성공 시나리오**

모든 테스트가 통과하면:
```
✅ Phase 1 & 2 완료!
✅ 프로덕션 배포 준비 완료!
✅ 사용자 테스트 시작 가능!

다음 단계:
1. 실제 사용자 피드백 수집
2. LLM 통합 (PRODUCT_SPEC_AND_LLM_INTEGRATION.md 참고)
3. 추가 기능 개발
```

---

**작성자**: Safe Pet Food 개발팀  
**버전**: 1.0  
**업데이트**: 2024-12-26
